<%
def m = [:];
%>          

<script>
var formatNumber = function( num ) {
  if (!(num)) num = 0.0;
  return num.toFixed(2); 
}
var formatDate = function( val ) {
  if (!(val)) return ""; 
  if (typeof val.getMonth === 'function') {;} 
  else val = new Date( val.toString() );  

  var opts = {year:'numeric', day:'numeric', month:'long'} 
  return val.toLocaleDateString('en-US', opts);   
}

var ctx = \$get('${PAGE.context}'); 
var billperiod = ctx.code.getBillPeriod(); 
</script>

<div class="row">
    <div class="col-xs-12">
      <div class="row page-header">
        <div class="col-md-6">
           <h2>
              <strong>
                BIN: <span r:context="${PAGE.context}" r:type="label">#{data.info.bin}</span> 
              </strong>
          </h2>
        </div>
        <div class="col-md-6">
           <h2>
              <strong>
                Date Filed: 
                <span r:context="${PAGE.context}" r:type="label">#{data.info.appdate}</span>
              </strong>
          </h2>
        </div>
      </div>
    </div>
</div>

<div class="row invoice-info">
  <div class="col-md-6">
            <form action="#" method="post" id="paymentOption">
                <div class="row">
                  <div class="col-md-3 col-xs-4">
                    <STRONG> Trade Name </STRONG>
                    <span class="pull-right">:</span>
                  </div>
                  <div class="col-sm-8 nopadleft">
                    <span r:context="${PAGE.context}" r:type="label">#{data.info.tradename}</span> 
                  </div>
                </div>

                <% if (!"ownername".matches(m.excludefield.toString())) { %> 
                <div class="row">
                  <div class="col-md-3 col-xs-4  "><STRONG>Owner Name</STRONG> <span class="pull-right">:</span></div>
                  <div class="col-sm-8 nopadleft" > 
                    <span r:context="${PAGE.context}" r:type="label">#{data.info.ownername}</span> 
                  </div>
                </div>
                <% } %> 
                
                <div class="row">
                  <div class="col-md-3 col-xs-4  "><STRONG>Application</STRONG><span class="pull-right">:</span> </div>
                  <div class="col-sm-8 nopadleft"> 
                    <span r:context="${PAGE.context}" r:type="label">#{data.info.apptype}</span> 
                  </div>
                </div>
            </form>
      </div>
      <div class="col-md-6">
            <form action="#" method="post" id="paymentOption">
                <div class="row">
                  <div class="col-md-2 col-xs-4"><STRONG>Address</STRONG><span class="pull-right">:</span></div>
                  <div class="col-sm-8 nopadleft"> 
                    <span r:context="${PAGE.context}" r:type="label">#{data.info.address}</span> 
                  </div>
                </div>
            </form>
      </div>   
</div>


<div class="row">
    <div class="col-md-12">
       <table class="table" r:context="${PAGE.context}" r:items="data.info.items" r:name="selectedItem" 
              r:varName="k" r:varStatus="stat">
          <thead>
            <tr>
              <th align="left">Line of Business</th>
              <th align="left">Tax/Fee</th>
              <th class="text-right">Amount</th>
              <th class="text-right">Discount</th>
              <th class="text-right">Surcharge</th>
              <th class="text-right">Interest</th>
              <th class="text-right">Total</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>#{k.lobname? k.lobname : ''}</td>
              <td>#{k.account}</td>
              <td align="right">#{formatNumber(k.amount)}</td>
              <td align="right">#{formatNumber(k.discount)}</td>
              <td align="right">#{formatNumber(k.surcharge)}</td>
              <td align="right">#{formatNumber(k.interest)}</td>
              <td align="right">#{formatNumber(k.total)}</td>
            </tr>
          </tbody>
          <tfooter>
            <tr>
              <th align="left" colspan="3"><span style="color:red">Note:</span> 
                THIS BILL IS VALID UNTIL &nbsp;
                <span r:context="${PAGE.context}" r:type="label">#{formatDate(data.info.expirydate).toUpperCase()}</span>
              </th>
              <th class="text-right" colspan="2"> BILL AMOUNT :</th>
              <th class="text-right" colspan="2">P 
                <span r:context="${PAGE.context}" r:type="label">#{formatNumber(data.amount)}</span>
              </th>
            </tr>
            <tr>
              <th align="left" colspan="7">
                BILL PERIOD : &nbsp;&nbsp;&nbsp;
                <span r:context="${PAGE.context}" r:type="label">#{billperiod}</span>
              </th> 
            </tr> 
          </tfooter>
        </table>
    </div>
</div>

<br>
<div class="row no-print">
    <div class="col-xs-12">

        <button r:context="${PAGE.context}" r:visibleWhen="#{data.amount > 0}" 
          class="btn-response btn btn-default" onClick="window.print()"><i class="fa fa-print"></i> Print</button>

        <button r:context="${PAGE.context}" r:name="pay" r:visibleWhen="#{data.amount > 0}" class="btn-response btn btn-primary pull-right">
          <i class="fa fa-credit-card"> </i> Pay Now 
        </button>

        <div r:context="${PAGE.context}" r:type="label" r:visibleWhen="#{data.amount > 0}" style="display:inline-block;visibility:hidden;"> 
          <form id="payform" method="post" action="/#{conf.ctxpath}/#{conf.orgname}/createpo" style="display:none;"> 
            <input type="hidden" name="successurl" value="/#{conf.ctxpath}/#{conf.orgname}/payoptions"/> 
            <input type="hidden" name="errorurl" value="#{conf.errorurl}&${System.currentTimeMillis()}"/> 
            <input type="hidden" name="hashkey" value="#{conf.hashkey}" id="conf-hashkey"/> 
            <input type="hidden" name="txntype" value="#{conf.txntype}"/> 
            <input type="hidden" name="orgcode" value="#{conf.orgcode}"/>
            <input type="hidden" name="refno" value="#{appno}"/>  
            <input type="hidden" name="qtr" value="#{option.qtr ? option.qtr : ''}"/> 
          </form> 
        </div> 

        <button r:context="${PAGE.context}" r:name="chooseQtr" r:visibleWhen="#{data.info.apptype == 'RENEW'}" 
          class=" btn-response btn btn-success pull-right" style="margin-right: 5px;"> Pay Option</button>

    </div>
</div>
